<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/></head><body>Skip to content<br>Sign in Sign up<br>Instantly share code, notes, and snippets.<br>Syed-Hassaan/GSP<a href="tel:345">345</a> | Automating Infrastructure on Google Cloud with Terraform: Challenge <a href="http://Lab.txt">Lab.txt</a><br>Created May 20, <a href="tel:2021 09">2021 09</a>:29<br>Clone this repository at &amp;lt;script src=&amp;quot;<a href="https://gist.github.com/Syed-Hassaan/e41a83345832666846ee6be0f69c1f36.js&amp;quot;&amp;gt;&amp;lt;/script&amp;gt">https://gist.github.com/Syed-Hassaan/e41a83345832666846ee6be0f69c1f36.js&amp;quot;&amp;gt;&amp;lt;/script&amp;gt</a>;<br><br>Code Revisions 1 Stars 20<br>Forks 7<br>GSP<a href="tel:345">345</a> | Automating Infrastructure on Google Cloud with Terraform: Challenge Lab<br>GSP<a href="tel:345">345</a> | Automating Infrastructure on Google Cloud with Terraform: Challenge <a href="http://Lab.txt">Lab.txt</a><br><br>######################################################################################<br><br><br>## Automating Infrastructure on Google Cloud with Terraform: Challenge Lab # GSP<a href="tel:345">345</a> ##<br><br><br>######################################################################################<br><br><br><br><br><br>====================== Setup : Create the configuration files ======================<br><br><br>Make the empty files and directories in Cloud Shell or the Cloud Shell Editor.<br><br><br>------------------------------------------------------------------------------------<br><br><br><br><br><br>touch <a href="http://main.tf">main.tf</a><br><br><br>touch <a href="http://variables.tf">variables.tf</a><br><br><br>mkdir modules<br><br><br>cd modules<br><br><br>mkdir instances<br><br><br>cd instances<br><br><br>touch <a href="http://instances.tf">instances.tf</a><br><br><br>touch <a href="http://outputs.tf">outputs.tf</a><br><br><br>touch <a href="http://variables.tf">variables.tf</a><br><br><br>cd ..<br><br><br>mkdir storage<br><br><br>cd storage<br><br><br>touch <a href="http://storage.tf">storage.tf</a><br><br><br>touch <a href="http://outputs.tf">outputs.tf</a><br><br><br>touch <a href="http://variables.tf">variables.tf</a><br><br><br>cd<br><br><br><br><br><br>--------------------------------------------------------------------------------<br><br><br>Add the following to the each <a href="http://variables.tf">variables.tf</a> file, and fill in the GCP Project ID:<br><br><br>--------------------------------------------------------------------------------<br><br><br><br><br><br>variable "region" {<br><br><br>default = "us-central1"<br><br><br>}<br><br><br><br><br><br>variable "zone" {<br><br><br>default = "us-central1-a"<br><br><br>}<br><br><br><br><br><br>variable "project_id" {<br><br><br>default = "&lt;FILL IN PROJECT ID&gt;"<br><br><br>}<br><br><br><br><br><br>------------------------------------------<br><br><br>Add the following to the <a href="http://main.tf">main.tf</a> file :<br><br><br>------------------------------------------<br><br><br><br><br><br>terraform {<br><br><br>required_providers {<br><br><br>google = {<br><br><br>source = "hashicorp/google"<br><br><br>version = "<a href="tel:3.55.0">3.55.0</a>"<br><br><br>}<br><br><br>}<br><br><br>}<br><br><br><br><br><br>provider "google" {<br><br><br>project = var.project_id<br><br><br>region = <a href="http://var.region">var.region</a><br><br><br><br><br><br>zone = <a href="http://var.zone">var.zone</a><br><br><br>}<br><br><br><br><br><br><br><br><br>module "instances" {<br><br><br><br><br><br>source = "./modules/instances"<br><br><br><br><br><br>}<br><br><br><br><br><br>---------------------------------------------------------------------------------<br><br><br>Run " terraform init " in Cloud Shell in the root directory to initialize terraform.<br><br><br>---------------------------------------------------------------------------------<br><br><br><br><br><br>====================== TASK 1: Import infrastructure ======================<br><br><br><br><br><br>Navigate to Compute Engine &gt; VM Instances. Click on tf-instance-1. Copy the Instance ID down somewhere to use later.<br><br><br><br><br><br>Navigate to Compute Engine &gt; VM Instances. Click on tf-instance-2. Copy the Instance ID down somewhere to use later.<br><br><br><br><br><br>Next, navigate to modules/instances/<a href="http://instances.tf">instances.tf</a>. Copy the following configuration into the file:<br><br><br><br><br><br>--------------------------------------------------------------<br><br><br><br><br><br>resource "google_compute_instance" "tf-instance-1" {<br><br><br>name = "tf-instance-1"<br><br><br>machine_type = "n1-standard-1"<br><br><br>zone = <a href="http://var.zone">var.zone</a><br><br><br><br><br><br>boot_disk {<br><br><br>initialize_params {<br><br><br>image = "debian-cloud/debian-10"<br><br><br>}<br><br><br>}<br><br><br><br><br><br>network_interface {<br><br><br>network = "default"<br><br><br>}<br><br><br>}<br><br><br><br><br><br>resource "google_compute_instance" "tf-instance-2" {<br><br><br>name = "tf-instance-2"<br><br><br>machine_type = "n1-standard-1"<br><br><br>zone = <a href="http://var.zone">var.zone</a><br><br><br><br><br><br>boot_disk {<br><br><br>initialize_params {<br><br><br>image = "debian-cloud/debian-10"<br><br><br>}<br><br><br>}<br><br><br><br><br><br>network_interface {<br><br><br>network = "default"<br><br><br>}<br><br><br>}<br><br><br><br><br><br>--------------------------------------------------------------------------------------------<br><br><br><br><br><br>To import the first instance, use the following command, using the Instance ID for tf-instance-1 you copied down earlier.<br><br><br><br><br><br>------------------------------------------------------------------------------------------<br><br><br>terraform import <a href="http://module.instances.google_compute_instance.tf">module.instances.google_compute_instance.tf</a>-instance-1 &lt;Instance ID - 1&gt;<br><br><br>------------------------------------------------------------------------------------------<br><br><br><br><br><br>To import the second instance, use the following command, using the Instance ID for tf-instance-2 you copied down earlier.<br><br><br><br><br><br>------------------------------------------------------------------------------------------<br><br><br>terraform import <a href="http://module.instances.google_compute_instance.tf">module.instances.google_compute_instance.tf</a>-instance-2 &lt;Instance ID - 2&gt;<br><br><br>------------------------------------------------------------------------------------------<br><br><br><br><br><br>The two instances have now been imported into your terraform configuration. You can now optionally run the commands to update the state of Terraform. Type yes at the dialogue after you run the apply command to accept the state changes.<br><br><br><br><br><br>----------------<br><br><br>terraform plan<br><br><br>terraform apply<br><br><br>----------------<br><br><br><br><br><br>====================== TASK 2: Configure a remote backend ======================<br><br><br><br><br><br>Add the following code to the modules/storage/<a href="http://storage.tf">storage.tf</a> file:<br><br><br><br><br><br>-------------------------------------------------------------------<br><br><br>resource "google_storage_bucket" "storage-bucket" {<br><br><br>name = var.project_id<br><br><br>location = "US"<br><br><br>force_destroy = true<br><br><br>uniform_bucket_level_access = true<br><br><br>}<br><br><br>-------------------------------------------------------------------<br><br><br><br><br><br>Next, add the following to the <a href="http://main.tf">main.tf</a> file:<br><br><br><br><br><br>------------------------------------------------------------------<br><br><br>module "storage" {<br><br><br>source = "./modules/storage"<br><br><br>}<br><br><br>----------------------------------------------------------------------------<br><br><br><br><br><br>Run the following commands to initialize the module and create the storage bucket resource. Type yes at the dialogue after you run the apply command to accept the state changes.<br><br><br><br><br><br>------------------------<br><br><br>terraform init<br><br><br>terraform apply<br><br><br>------------------------<br><br><br><br><br><br>Next, update the <a href="http://main.tf">main.tf</a> file so that the terraform block looks like the following. Fill in your GCP Project ID for the bucket argument definition.<br><br><br><br><br><br>-------------------------------------------<br><br><br>terraform {<br><br><br>backend "gcs" {<br><br><br>bucket = "&lt;FILL IN PROJECT ID&gt;"<br><br><br>prefix = "terraform/state"<br><br><br>}<br><br><br>required_providers {<br><br><br>google = {<br><br><br>source = "hashicorp/google"<br><br><br>version = "<a href="tel:3.55.0">3.55.0</a>"<br><br><br>}<br><br><br>}<br><br><br>}<br><br><br>--------------------------------------------<br><br><br><br><br><br>Run the following to initialize the remote backend. Type yes at the prompt.<br><br><br><br><br><br>----------------<br><br><br>terraform init<br><br><br>----------------<br><br><br><br><br><br>====================== TASK 3: Modify and update infrastructure ======================<br><br><br><br><br><br>Navigate to modules/instances/<a href="http://instance.tf">instance.tf</a>. Replace the entire contents of the file with the following:<br><br><br><br><br><br>--------------------------------------------------------<br><br><br>resource "google_compute_instance" "tf-instance-1" {<br><br><br>name = "tf-instance-1"<br><br><br>machine_type = "n1-standard-2"<br><br><br>zone = <a href="http://var.zone">var.zone</a><br><br><br>allow_stopping_for_update = true<br><br><br><br><br><br>boot_disk {<br><br><br>initialize_params {<br><br><br>image = "debian-cloud/debian-10"<br><br><br>}<br><br><br>}<br><br><br><br><br><br>network_interface {<br><br><br>network = "default"<br><br><br>}<br><br><br>}<br><br><br><br><br><br>resource "google_compute_instance" "tf-instance-2" {<br><br><br>name = "tf-instance-2"<br><br><br>machine_type = "n1-standard-2"<br><br><br>zone = <a href="http://var.zone">var.zone</a><br><br><br>allow_stopping_for_update = true<br><br><br><br><br><br>boot_disk {<br><br><br>initialize_params {<br><br><br>image = "debian-cloud/debian-10"<br><br><br>}<br><br><br>}<br><br><br><br><br><br>network_interface {<br><br><br>network = "default"<br><br><br>}<br><br><br>}<br><br><br><br><br><br>resource "google_compute_instance" "tf-instance-3" {<br><br><br>name = "tf-instance-3"<br><br><br>machine_type = "n1-standard-2"<br><br><br>zone = <a href="http://var.zone">var.zone</a><br><br><br>allow_stopping_for_update = true<br><br><br><br><br><br>boot_disk {<br><br><br>initialize_params {<br><br><br>image = "debian-cloud/debian-10"<br><br><br>}<br><br><br>}<br><br><br><br><br><br>network_interface {<br><br><br>network = "default"<br><br><br>}<br><br><br>}<br><br><br>--------------------------------------------------------------------------------------------------<br><br><br><br><br><br>Run the following commands to initialize the module and create/update the instance resources. Type yes at the dialogue after you run the apply command to accept the state changes.<br><br><br><br><br><br>----------------<br><br><br>terraform init<br><br><br>terraform apply<br><br><br>----------------<br><br><br><br><br><br>====================== TASK 4: Taint and destroy resources ======================<br><br><br><br><br><br>Taint the tf-instance-3 resource by running the following command:<br><br><br><br><br><br>------------------------------------------------------------------------<br><br><br>terraform taint <a href="http://module.instances.google_compute_instance.tf">module.instances.google_compute_instance.tf</a>-instance-3<br><br><br>------------------------------------------------------------------------<br><br><br><br><br><br>Run the following commands to apply the changes:<br><br><br><br><br><br>----------------<br><br><br>terraform init<br><br><br>terraform apply<br><br><br>----------------<br><br><br><br><br><br>Remove the tf-instance-3 resource from the <a href="http://instances.tf">instances.tf</a> file. Delete the following code chunk from the file.<br><br><br><br><br><br>-----------------------------------------------------------<br><br><br>resource "google_compute_instance" "tf-instance-3" {<br><br><br>name = "tf-instance-3"<br><br><br>machine_type = "n1-standard-2"<br><br><br>zone = <a href="http://var.zone">var.zone</a><br><br><br>allow_stopping_for_update = true<br><br><br><br><br><br>boot_disk {<br><br><br>initialize_params {<br><br><br>image = "debian-cloud/debian-10"<br><br><br>}<br><br><br>}<br><br><br><br><br><br>network_interface {<br><br><br>network = "default"<br><br><br>}<br><br><br>}<br><br><br>--------------------------------------------------------------------<br><br><br><br><br><br>Run the following commands to apply the changes. Type yes at the prompt.<br><br><br><br><br><br>----------------<br><br><br>terraform apply<br><br><br>----------------<br><br><br><br><br><br>====================== TASK 5: Use a module from the Registry ======================<br><br><br>Copy and paste the following into the <a href="http://main.tf">main.tf</a> file:<br><br><br><br><br><br>----------------------------------------------------------------<br><br><br>module "vpc" {<br><br><br>source = "terraform-google-modules/network/google"<br><br><br>version = "~&gt; <a href="tel:3.2.2">3.2.2</a>"<br><br><br><br><br><br>project_id = var.project_id<br><br><br>network_name = "terraform-vpc"<br><br><br>routing_mode = "GLOBAL"<br><br><br><br><br><br>subnets = [<br><br><br>{<br><br><br>subnet_name = "subnet-01"<br><br><br>subnet_ip = "<a href="http://10.10.10.0/24">10.10.10.0/24</a>"<br><br><br>subnet_region = "us-central1"<br><br><br>},<br><br><br>{<br><br><br>subnet_name = "subnet-02"<br><br><br>subnet_ip = "<a href="http://10.10.20.0/24">10.10.20.0/24</a>"<br><br><br>subnet_region = "us-central1"<br><br><br>subnet_private_access = "true"<br><br><br>subnet_flow_logs = "true"<br><br><br>description = "This subnet has a description"<br><br><br>}<br><br><br>]<br><br><br>}<br><br><br>-------------------------------------------------------------------------------<br><br><br><br><br><br>Run the following commands to initialize the module and create the VPC. Type yes at the prompt.<br><br><br><br><br><br>---------------<br><br><br>terraform init<br><br><br>terraform apply<br><br><br>----------------<br><br><br><br><br><br>Navigate to modules/instances/<a href="http://instances.tf">instances.tf</a>. Replace the entire contents of the file with the following:<br><br><br><br><br><br>-------------------------------------------------------<br><br><br>resource "google_compute_instance" "tf-instance-1" {<br><br><br>name = "tf-instance-1"<br><br><br>machine_type = "n1-standard-2"<br><br><br>zone = <a href="http://var.zone">var.zone</a><br><br><br>allow_stopping_for_update = true<br><br><br><br><br><br>boot_disk {<br><br><br>initialize_params {<br><br><br>image = "debian-cloud/debian-10"<br><br><br>}<br><br><br>}<br><br><br><br><br><br>network_interface {<br><br><br>network = "terraform-vpc"<br><br><br>subnetwork = "subnet-01"<br><br><br>}<br><br><br>}<br><br><br><br><br><br>resource "google_compute_instance" "tf-instance-2" {<br><br><br>name = "tf-instance-2"<br><br><br>machine_type = "n1-standard-2"<br><br><br>zone = <a href="http://var.zone">var.zone</a><br><br><br>allow_stopping_for_update = true<br><br><br><br><br><br>boot_disk {<br><br><br>initialize_params {<br><br><br>image = "debian-cloud/debian-10"<br><br><br>}<br><br><br>}<br><br><br><br><br><br>network_interface {<br><br><br>network = "terraform-vpc"<br><br><br>subnetwork = "subnet-02"<br><br><br>}<br><br><br>}<br><br><br>--------------------------------------------------------------------------------------------<br><br><br><br><br><br>Run the following commands to initialize the module and update the instances. Type yes at the prompt.<br><br><br><br><br><br>---------------<br><br><br>terraform init<br><br><br>terraform apply<br><br><br>----------------<br><br><br><br><br><br>====================== TASK 6: Configure a firewall ======================<br><br><br>Add the following resource to the <a href="http://main.tf">main.tf</a> file and fill in the GCP Project ID:<br><br><br><br><br><br>------------------------------------------------------------------<br><br><br>resource "google_compute_firewall" "tf-firewall" {<br><br><br>name = "tf-firewall"<br><br><br>network = "projects/&lt;PROJECT_ID&gt;/global/networks/terraform-vpc"<br><br><br><br><br><br>allow {<br><br><br>protocol = "tcp"<br><br><br>ports = ["80"]<br><br><br>}<br><br><br><br><br><br>source_tags = ["web"]<br><br><br>source_ranges = ["<a href="tel:0.0.0.0">0.0.0.0</a>/0"]<br><br><br>}<br><br><br>-------------------------------------------------------------------------<br><br><br><br><br><br>Run the following commands to configure the firewall. Type yes at the prompt.<br><br><br><br><br><br>---------------------<br><br><br>terraform init<br><br><br>terraform apply<br><br><br>----------------------<br><br><br><br><br><br>######################################################################################<br><br><br>## Automating Infrastructure on Google Cloud with Terraform: Challenge Lab # GSP<a href="tel:345">345</a> ##<br><br><br>######################################################################################<br>DynamiteC commented Oct 24, <a href="tel:2021">2021</a><br>resource "google_compute_instance" "tf-instance-1" { name = "tf-instance-1" machine_type = "n1-standard-1" zone = <a href="http://var.zone">var.zone</a> boot_disk { initialize_params { image = "debian-cloud/debian-10" } } network_interface { network = "default" } metadata_startup_script = &lt;&lt;-EOT #!/bin/bash EOT allow_stopping_for_update = true }<br>resource "google_compute_instance" "tf-instance-2" { name = "tf-instance-2" machine_type = "n1-standard-1" zone = <a href="http://var.zone">var.zone</a> boot_disk { initialize_params { image = "debian-cloud/debian-10" } } network_interface { network = "default" } metadata_startup_script = &lt;&lt;-EOT #!/bin/bash EOT allow_stopping_for_update = true }<br>ghost commented Nov 4, <a href="tel:2021">2021</a><br>TASK 1: Import infrastructure fails. Attempted several times, milestone never achieved.<br>bhanu-prakashl commented Nov 6, <a href="tel:2021">2021</a><br>This lab has some issue<br>adelkhayata76 commented Nov 21, <a href="tel:2021">2021</a><br>I just got <a href="tel:100">100</a>% in this lab!<br>You just need to pay attention to these steps:<br>Add the following to each instance block:<br>metadata_startup_script = &lt;&lt;-EOT<br>#!/bin/bash<br>EOT<br>allow_stopping_for_update = true<br><br>You should replace "tf-instance-3" text with the instance name assigned to you by the lab ( You can find it on left panel ).<br>You should replace the Google Storage Bucket Name with the one assigned to you by the lab ( You can find it on left panel ).<br>You should replace the "terraform-vpc" text with the VPC name assigned to you by the lab ( You can find it on left panel ).<br>I was having issues with the zone variable inside <a href="http://instances.tf">instances.tf</a> so I replaced it with my project ID.<br>yogeshbirje commented Dec 13, <a href="tel:2021">2021</a><br>Hi,<br>How to overcome this scenario,<br>metadata_startup_script = &lt;&lt;-EOT #!/bin/bash EOT allow_stopping_for_update = true<br>Aabhusan commented Dec 24, <a href="tel:2021">2021</a><br>I have just completed it. i have added all the codes to the repo. . when you clone delete .terraform, and <a href="http://terraform.tfstate">terraform.tfstate</a> files. <a href="https://github.com/Aabhusan/terraform-labs">https://github.com/Aabhusan/terraform-labs</a><br>akhyaruu commented Jan 21, <a href="tel:2022">2022</a><br>I can complete the challenge lab because of this code, but it just helps 55% only. So I'll leave it note in here:<br>First is my advice when you want to use this code<br>DON'T COPY PASTE the code without understanding what you're doing and ofc following along with lab instruction<br>please take a look at what VARIABLE you should give to the code<br>always RE-READ the instruction so there's nothing in left<br>you can always go back to the previous lab for seeing code<br>Second is some additional code for providing more detail about that's one<br>every instance block resource "google_compute_instance" "tf-instance-&lt;NUMBER&gt;" {} before the closing statement add this code metadata_startup_script = &lt;&lt;-EOT #!/bin/bash EOT allow_stopping_for_update = true<br>replace any variable name like "tf-instance-3", "terraform-vpc", and "Google storage bucket name" with the variable given from the lab<br>you don't need to specify the argument zone when creating instance<br>itistech commented Jun 17, <a href="tel:2022">2022</a><br>This lab has some issue. Not al the steps are correct<br>johnnieng commented Jun 26, <a href="tel:2022">2022</a><br><a href="https://gist.github.com/Syed-Hassaan/e41a83345832666846ee6be0f69c1f36?permalink_comment_id=3937718#gistcomment-3937718">https://gist.github.com/Syed-Hassaan/e41a83345832666846ee6be0f69c1f36?permalink_comment_id=3937718#gistcomment-3937718</a><br>resource "google_storage_bucket" "storage-bucket" { name = "tf-bucket-<a href="tel:148026">148026</a>" location = "US" force_destroy = true uniform_bucket_level_access = true }<br>terraform { backend "gcs" { bucket = "tf-bucket-<a href="tel:148026">148026</a>" prefix = "terraform/state" } required_providers { google = { source = "hashicorp/google" version = "<a href="tel:3.55.0">3.55.0</a>" } } } provider "google" { project = var.project_id region = <a href="http://var.region">var.region</a> zone = <a href="http://var.zone">var.zone</a> } module "instances" { source = "./modules/instances" } module "storage" { source = "./modules/storage" }<br>resource "google_compute_instance" "tf-instance-1" { name = "tf-instance-1" machine_type = "n1-standard-2" zone = <a href="http://var.zone">var.zone</a> boot_disk { initialize_params { image = "debian-cloud/debian-10" } } network_interface { network = "default" } metadata_startup_script = &lt;&lt;-EOT #!/bin/bash EOT allow_stopping_for_update = true } resource "google_compute_instance" "tf-instance-2" { name = "tf-instance-2" machine_type = "n1-standard-2" zone = <a href="http://var.zone">var.zone</a> boot_disk { initialize_params { image = "debian-cloud/debian-10" } } network_interface { network = "default" } metadata_startup_script = &lt;&lt;-EOT #!/bin/bash EOT allow_stopping_for_update = true } resource "google_compute_instance" "tf-instance-3" { name = "tf-instance-<a href="tel:182056">182056</a>" machine_type = "n1-standard-2" zone = <a href="http://var.zone">var.zone</a> boot_disk { initialize_params { image = "debian-cloud/debian-10" } } network_interface { network = "default" } metadata_startup_script = &lt;&lt;-EOT #!/bin/bash EOT allow_stopping_for_update = true }<br>module "vpc" { source = "terraform-google-modules/network/google" version = "~&gt; <a href="tel:3.4.0">3.4.0</a>" project_id = var.project_id network_name = "tf-vpc-<a href="tel:391516">391516</a>" routing_mode = "GLOBAL" subnets = [ { subnet_name = "subnet-01" subnet_ip = "<a href="http://10.10.10.0/24">10.10.10.0/24</a>" subnet_region = "us-central1" }, { subnet_name = "subnet-02" subnet_ip = "<a href="http://10.10.20.0/24">10.10.20.0/24</a>" subnet_region = "us-central1" subnet_private_access = "true" subnet_flow_logs = "true" description = "This subnet has a description" } ] }<br>resource "google_compute_instance" "tf-instance-1" { name = "tf-instance-1" machine_type = "n1-standard-2" zone = <a href="http://var.zone">var.zone</a> boot_disk { initialize_params { image = "debian-cloud/debian-10" } } network_interface { network = "tf-vpc-<a href="tel:391516">391516</a>" subnetwork = "subnet-01" } metadata_startup_script = &lt;&lt;-EOT #!/bin/bash EOT allow_stopping_for_update = true } resource "google_compute_instance" "tf-instance-2" { name = "tf-instance-2" machine_type = "n1-standard-2" zone = <a href="http://var.zone">var.zone</a> boot_disk { initialize_params { image = "debian-cloud/debian-10" } } network_interface { network = "tf-vpc-<a href="tel:391516">391516</a>" subnetwork = "subnet-02" } metadata_startup_script = &lt;&lt;-EOT #!/bin/bash EOT allow_stopping_for_update = true }<br>resource "google_compute_firewall" "tf-firewall" { name = "tf-firewall" network = "projects/qwiklabs-gcp-02-b84ff<a href="tel:56656">56656</a>df/global/networks/tf-vpc-<a href="tel:391516">391516</a>" allow { protocol = "tcp" ports = ["80"] } source_tags = ["web"] source_ranges = ["<a href="tel:0.0.0.0">0.0.0.0</a>/0"] }<br>aagirre92 commented Aug 24, <a href="tel:2022">2022</a> •<br>Even though I create the infrastructure with Terraform (correctly importing the already existent instances) the checkpoint always states "Please create <a href="http://instances.tf">instances.tf</a> file and import both instances and update them using Terraform.".<br>My <a href="http://main.tf">main.tf</a> file looks like this;<br>` terraform { backend "local" { path = "terraform/state/<a href="http://terraform.tfstate">terraform.tfstate</a>" } }<br>provider "google" { project = var.project_id region = <a href="http://var.region">var.region</a> zone = <a href="http://var.zone">var.zone</a> }<br>module "instances" { source = "./modules/instances"<br>} `<br>deveshase commented Dec 1, <a href="tel:2022">2022</a> •<br>Just completed the lab today (after attempting for the 3rd time) - For anyone getting this error, "Please create <a href="http://instances.tf">instances.tf</a> file and import both instances and update them using Terraform."<br>Instructions are incorrect, if you add metadata startup script instances do not upgrade in place and they are destroyed and recreated which is not what the lab wants so you will get this error: "Please create <a href="http://instances.tf">instances.tf</a> file and import both instances and update them using Terraform.". Remove it from your <a href="http://instances.tf">instances.tf</a> and you'll be good.<br>modules/ └── instances ├── <a href="http://instances.tf">instances.tf</a> ├── <a href="http://outputs.tf">outputs.tf</a> └── <a href="http://variables.tf">variables.tf</a><br>└── storage ├── <a href="http://storage.tf">storage.tf</a> ├── <a href="http://outputs.tf">outputs.tf</a> └── <a href="http://variables.tf">variables.tf</a><br>touch <a href="http://main.tf">main.tf</a> <a href="http://variables.tf">variables.tf</a> mkdir -p modules/instances mkdir -p modules/storage<br>cd modules/instances touch <a href="http://instances.tf">instances.tf</a> <a href="http://variables.tf">variables.tf</a> <a href="http://output.tf">output.tf</a><br>cd .. cd storage touch <a href="http://storage.tf">storage.tf</a> <a href="http://variables.tf">variables.tf</a> <a href="http://output.tf">output.tf</a><br>cd .. cd ..<br><a href="http://variables.tf">variables.tf</a><br>```<br><br>variable "region" {<br>&nbsp;&nbsp;&nbsp; default = "us-east1"<br>}<br><br>variable "zone" {<br>&nbsp;&nbsp;&nbsp; default = "us-east1-c"<br>}<br><br>variable "project_id" {<br>&nbsp;&nbsp;&nbsp; default = "qwiklabs-gcp-<a href="tel:02-2">02-2</a>e28a7a<a href="tel:4085">4085</a>e"<br>}<br>```<br><br><br><a href="http://main.tf">main.tf</a><br>~~~~~~~~~~<br><br>//do not use provider version<br>```<br>terraform {<br>&nbsp;&nbsp;&nbsp; required_providers {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; google =&nbsp; {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; source = "hashicorp/google"<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br>&nbsp;&nbsp;&nbsp; }&nbsp;&nbsp; <br>}<br><br>provider "google" {<br>&nbsp;&nbsp;&nbsp; project = var.project_id<br>&nbsp;&nbsp;&nbsp; regi</body></html>